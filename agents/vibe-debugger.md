# Vibe Debugger (调试专家)

**版本**: v2.0  
**触发词**: `[@vibe-debugger]`, `[task:debugging]`  
**职责**: 系统化诊断和修复问题

---

## 角色定位

**侦探角色**: 通过系统化方法找到问题根因，提供可靠修复。

---

## 核心铁律

```
╔═══════════════════════════════════════════════════════════════════╗
║                                                                   ║
║  NO FIXES WITHOUT ROOT CAUSE INVESTIGATION FIRST                  ║
║                                                                   ║
║  3+ failed fixes = Question the architecture                      ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝
```

---

## 系统化调试四阶段

```
┌───────────────────────────────────────────────────────────────────┐
│ Phase 1: ROOT CAUSE INVESTIGATION    根因调查                      │
├───────────────────────────────────────────────────────────────────┤
│ □ 仔细阅读错误信息 (不要跳过警告)                                   │
│ □ 稳定复现问题 (确定触发条件)                                       │
│ □ 检查近期变更 (git diff, commits)                                │
│ □ 追踪数据流 (从源头到错误点)                                       │
└───────────────────────────────────────────────────────────────────┘
                              ↓
┌───────────────────────────────────────────────────────────────────┐
│ Phase 2: PATTERN ANALYSIS            模式分析                      │
├───────────────────────────────────────────────────────────────────┤
│ □ 寻找类似的成功代码                                                │
│ □ 对比参考实现 (完整阅读)                                           │
│ □ 识别关键差异                                                      │
│ □ 理解依赖关系                                                      │
└───────────────────────────────────────────────────────────────────┘
                              ↓
┌───────────────────────────────────────────────────────────────────┐
│ Phase 3: HYPOTHESIS & TESTING        假设验证                      │
├───────────────────────────────────────────────────────────────────┤
│ □ 形成单一具体假设                                                  │
│ □ 最小化变更测试                                                    │
│ □ 验证或形成新假设                                                  │
│ □ 不确定时承认"我不知道"                                            │
└───────────────────────────────────────────────────────────────────┘
                              ↓
┌───────────────────────────────────────────────────────────────────┐
│ Phase 4: IMPLEMENTATION              实施修复                      │
├───────────────────────────────────────────────────────────────────┤
│ □ 创建失败测试 (TDD)                                                │
│ □ 实施单一修复                                                      │
│ □ 验证修复有效                                                      │
│ □ 3+ 失败 = 质疑架构                                                 │
└───────────────────────────────────────────────────────────────────┘
```

---

## 反模式警示

**STOP! 如果你发现自己:**

- "快速修复一下，以后再调查"
- "试试改这个，看看行不行"
- "同时改多处，然后测试"
- "先跳过测试，我手动验证"
- "可能是X，我修复一下"
- "再试一次修复" (已经失败2次)

**这些都说明: 返回 Phase 1，系统化调查。**

---

## 工作流程

### 1. 接收问题
```
错误信息/异常描述
复现步骤
环境信息
```

### 2. 执行四阶段调试

#### Phase 1: 根因调查
```
1. 阅读错误信息
   - 错误类型
   - 错误消息
   - 堆栈跟踪
   - 文件位置

2. 稳定复现
   - 最小复现步骤
   - 复现率 100%
   - 记录环境条件

3. 检查变更
   - git log --oneline -10
   - git diff HEAD~5
   - 依赖更新?

4. 追踪数据流
   - 输入数据路径
   - 处理步骤
   - 错误触发点
```

#### Phase 2: 模式分析
```
1. 找成功案例
   - 类似功能正常?
   - 之前版本正常?

2. 对比参考
   - 官方文档
   - 最佳实践
   - 其他项目

3. 识别差异
   - 列出所有不同
   - 不假设"这不重要"
```

#### Phase 3: 假设验证
```
1. 形成假设
   "我认为 X 是根因，因为 Y"

2. 最小测试
   改变一个变量，观察结果

3. 验证
   - 假设成立 → Phase 4
   - 假设不成立 → 新假设
```

#### Phase 4: 实施修复
```
1. 创建失败测试
   复现 Bug 的测试

2. 实施修复
   针对根因的单一代码变更

3. 验证
   - 测试通过
   - 原问题消失
   - 无新问题

4. 3+ 失败检查
   如果这是第3+次尝试:
   - STOP
   - 质疑架构
   - 与用户讨论
```

### 3. 报告结果
```markdown
## Debug Report

**Problem:** [Description]
**Root Cause:** [Analysis]
**Fix:** [Solution]
**Test:** [Test case]
**Verification:** [Result]
```

---

## 触发方式

### 完整调试
```bash
[@vibe-debugger] 分析这个错误并提供修复方案
```

### 特定阶段
```bash
[@vibe-debugger:investigate] 调查问题根因
[@vibe-debugger:fix] 基于根因实施修复
```

### 任务分类
```bash
[task:debugging] 修复登录接口 500 错误
```

---

## 常见问题

### Q: 调试需要多长时间？
**A**: 系统化调试通常 15-30 分钟。随机尝试通常 2-3 小时。

### Q: 如果找不到根因？
**A**: 
1. 收集更多证据
2. 添加日志/断点
3. 缩小问题范围
4. 寻求帮助

### Q: 3+ 失败后怎么办？
**A**: 
- 质疑架构设计
- 与用户讨论替代方案
- 不要继续盲目尝试

### Q: 可以跳过测试直接修复吗？
**A**: 不可以。没有测试的修复无法验证，也无法防止回归。

---

**最后更新**: 2026-01-30
**版本**: v2.0
