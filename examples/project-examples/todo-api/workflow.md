# Agent 协作流程详解

本文档详细说明 Vibe Coding Team 的 5 个 Agent 如何协作完成 TODO API 项目。

---

## 🎭 角色分工

### 1. Vibe Architect (架构指挥官) 🎨

**职责**: 把握整体方向，设计架构，协调团队

**工作流程**:
```
接收用户需求
  ↓
需求分析
  ↓
技术选型
  ↓
架构设计
  ↓
定义 API 端点
  ↓
协调其他 Agent
  ↓
整合最终输出
```

**输出**:
- ✅ 需求分析文档
- ✅ 架构设计文档
- ✅ API 端点定义
- ✅ 技术栈选择

---

### 2. Vibe Coder (编码乐手) 🎹

**职责**: 根据架构设计生成具体代码

**工作流程**:
```
接收架构规格
  ↓
实现数据模型
  ↓
实现业务逻辑层
  ↓
实现控制器层
  ↓
定义路由
  ↓
配置 Express 应用
```

**输出**:
- ✅ Task.js (数据模型)
- ✅ taskService.js (业务逻辑)
- ✅ taskController.js (控制器)
- ✅ taskRoutes.js (路由)
- ✅ app.js (应用配置)
- ✅ server.js (入口文件)

---

### 3. Vibe Reviewer (质量守门人) 🔍

**职责**: 审查代码质量、安全性、性能

**工作流程**:
```
接收代码
  ↓
代码质量审查
  ↓
安全性检查
  ↓
性能评估
  ↓
最佳实践验证
  ↓
生成审查报告
```

**输出**:
- ✅ 代码质量评分
- ✅ 安全性问题列表
- ✅ 性能优化建议
- ✅ 改进方案

---

### 4. Vibe Debugger (调试专家) 🐛

**职责**: 生成测试用例，验证代码正确性

**工作流程**:
```
分析代码结构
  ↓
设计测试策略
  ↓
生成单元测试
  ↓
生成集成测试
  ↓
生成边界测试
  ↓
验证测试覆盖
```

**输出**:
- ✅ 单元测试套件
- ✅ 集成测试套件
- ✅ 边界情况测试
- ✅ 测试报告

---

### 5. Vibe Documenter (文档生成器) 📚

**职责**: 生成 API 文档和使用说明

**工作流程**:
```
分析代码和 API 端点
  ↓
提取 API 信息
  ↓
生成 API 文档
  ↓
添加使用示例
  ↓
生成最佳实践指南
```

**输出**:
- ✅ API 端点文档
- ✅ 请求/响应示例
- ✅ 错误码说明
- ✅ 使用指南

---

## 🔄 完整协作流程

### Phase 1: 需求分析与架构设计

```
用户输入:
[vibe-architect] 我需要一个简单的任务管理 API...
    ↓
Vibe Architect 启动
    ↓
步骤 1: 需求分析
  - 识别功能需求
  - 识别非功能需求
  - 明确约束条件
    ↓
步骤 2: 技术选型
  - 选择框架: Express.js
  - 选择存储: 内存存储
  - 选择 API 风格: RESTful
    ↓
步骤 3: 架构设计
  - 设计目录结构
  - 定义模块划分
  - 定义层次架构
    ↓
步骤 4: API 端点设计
  - 定义端点路径
  - 定义请求方法
  - 定义请求/响应格式
    ↓
输出:
  ✅ 需求分析文档
  ✅ 架构设计文档
  ✅ API 端点设计
```

**耗时**: 约 10 分钟

---

### Phase 2: 代码生成

```
Vibe Architect 传递架构设计给 Vibe Coder
    ↓
Vibe Coder 启动
    ↓
步骤 1: 实现数据模型 (Task.js)
  - 定义 Task 类
  - 实现 validate() 方法
  - 实现 toJSON() 方法
    ↓
步骤 2: 实现业务逻辑层 (taskService.js)
  - 实现 CRUD 操作
  - 实现数据验证
  - 实现错误处理
    ↓
步骤 3: 实现控制器层 (taskController.js)
  - 实现 HTTP 请求处理
  - 实现 HTTP 响应格式化
  - 实现错误处理
    ↓
步骤 4: 定义路由 (taskRoutes.js)
  - 定义 API 端点
  - 关联控制器方法
    ↓
步骤 5: 配置应用 (app.js)
  - 配置 Express 中间件
  - 注册路由
  - 配置错误处理
    ↓
步骤 6: 创建入口文件 (server.js)
  - 启动 HTTP 服务器
  - 监听端口
    ↓
输出:
  ✅ 完整的可运行代码
```

**耗时**: 约 20 分钟

---

### Phase 3: 代码审查

```
Vibe Coder 传递代码给 Vibe Reviewer
    ↓
Vibe Reviewer 启动
    ↓
步骤 1: 代码质量审查
  - 检查代码结构
  - 检查命名规范
  - 检查代码复杂度
  - 检查错误处理
    ↓
步骤 2: 安全性检查
  - 检查输入验证
  - 检查 XSS 防护
  - 检查注入攻击防护
  - 检查敏感信息泄露
    ↓
步骤 3: 性能评估
  - 检查算法复杂度
  - 检查资源使用
  - 检查潜在的瓶颈
    ↓
步骤 4: 最佳实践验证
  - 检查设计模式应用
  - 检查 SOLID 原则
  - 检查代码复用
    ↓
输出:
  ✅ 审查报告
  ✅ 问题列表
  ✅ 改进建议
```

**耗时**: 约 10 分钟

---

### Phase 4: 测试生成

```
Vibe Reviewer 传递审查报告给 Vibe Debugger
    ↓
Vibe Debugger 启动
    ↓
步骤 1: 分析代码结构
  - 识别测试点
  - 识别边界情况
  - 识别依赖关系
    ↓
步骤 2: 生成单元测试
  - 测试 Task 模型
  - 测试 TaskService 方法
  - 测试边界条件
    ↓
步骤 3: 生成集成测试
  - 测试 API 端点
  - 测试请求/响应
  - 测试错误场景
    ↓
步骤 4: 生成边界测试
  - 测试输入验证
  - 测试并发操作
  - 测试极端情况
    ↓
输出:
  ✅ 单元测试套件
  ✅ 集成测试套件
  ✅ 边界测试套件
```

**耗时**: 约 15 分钟

---

### Phase 5: 文档生成

```
Vibe Coder 传递代码给 Vibe Documenter
    ↓
Vibe Documenter 启动
    ↓
步骤 1: 分析代码
  - 提取 API 端点
  - 提取请求/响应格式
  - 提取错误码
    ↓
步骤 2: 生成 API 文档
  - 编写端点说明
  - 添加请求示例
  - 添加响应示例
    ↓
步骤 3: 添加使用指南
  - 编写快速开始
  - 添加代码示例
  - 添加最佳实践
    ↓
输出:
  ✅ API 文档
  ✅ 使用指南
```

**耗时**: 约 10 分钟

---

### Phase 6: 最终整合

```
Vibe Architect 收集所有输出
    ↓
步骤 1: 验证完整性
  - 检查代码是否完整
  - 检查测试是否覆盖
  - 检查文档是否齐全
    ↓
步骤 2: 质量把控
  - 验证是否达到质量标准
  - 验证是否满足需求
  - 验证是否处理了审查问题
    ↓
步骤 3: 整合输出
  - 整合代码
  - 整合测试
  - 整合文档
    ↓
输出:
  ✅ 完整的交付物
```

**耗时**: 约 5 分钟

---

## 📊 时间分配

| 阶段 | Agent | 耗时 | 输出 |
|------|-------|------|------|
| 需求分析与架构设计 | Vibe Architect | 10 分钟 | 架构文档 |
| 代码生成 | Vibe Coder | 20 分钟 | 代码实现 |
| 代码审查 | Vibe Reviewer | 10 分钟 | 审查报告 |
| 测试生成 | Vibe Debugger | 15 分钟 | 测试套件 |
| 文档生成 | Vibe Documenter | 10 分钟 | API 文档 |
| 最终整合 | Vibe Architect | 5 分钟 | 完整交付物 |
| **总计** | **所有 Agent** | **70 分钟** | **完整项目** |

---

## 🎯 关键成功因素

### 1. 清晰的需求表达

```bash
❌ 不好: [vibe-architect] 做个任务管理 API

✅ 好: [vibe-architect] 我需要一个简单的任务管理 API，支持：
  - 创建任务（标题、描述、优先级）
  - 查看所有任务
  - 更新任务状态（待办/进行中/已完成）
  - 删除任务
  使用 Node.js + Express，内存存储即可
```

### 2. 合理的 Agent 调用

```bash
# 对于完整项目，使用 vibe-architect 协调
[vibe-architect] 完整的项目需求...

# 对于单一任务，指定特定 Agent
[@vibe-coder] 实现特定功能...
[@vibe-reviewer] 审查代码...
[@vibe-debugger] 生成测试...
[@vibe-documenter] 生成文档...
```

### 3. 充分的上下文传递

每个 Agent 接收前一个 Agent 的输出作为输入：
```
Vibe Architect 的输出 → Vibe Coder 的输入
Vibe Coder 的输出 → Vibe Reviewer 的输入
Vibe Reviewer 的输出 → Vibe Debugger 的输入
Vibe Coder 的输出 → Vibe Documenter 的输入
```

### 4. 及时的反馈和调整

```bash
# 如果代码质量不满意，可以要求改进
[@vibe-coder] 基于审查报告的反馈，改进以下方面：
  1. 添加输入验证
  2. 改进错误处理
  3. 添加日志记录
```

---

## 🔄 并行执行优化

对于某些任务，Agent 可以并行执行以提高效率：

```
Vibe Architect 设计架构
    ↓
┌─────────────┬─────────────┐
│  Vibe Coder │ Vibe Review │
│  (代码生成)  │  (审查架构)  │
└─────────────┴─────────────┘
         ↓
    Vibe Debugger
    (生成测试)
         ↓
┌─────────────┬─────────────┐
│Vibe Document│Vibe Reviewer│
│  (生成文档)  │  (审查代码)  │
└─────────────┴─────────────┘
         ↓
    Vibe Architect
    (最终整合)
```

---

## 📝 总结

通过这个协作流程，您可以：

1. ✅ **快速启动项目**
   - 用自然语言描述需求
   - 自动获得架构设计

2. ✅ **保证代码质量**
   - 多层质量检查
   - 自动生成测试

3. ✅ **提高开发效率**
   - Agent 协作，各司其职
   - 自动化重复工作

4. ✅ **保持文档同步**
   - 自动生成文档
   - 代码和文档一致

---

**最后更新**: 2026-01-27
